<% content_for :head do %>
	<%= stylesheet_link_tag "forms" %>
	<%= stylesheet_link_tag "table" %>
	<script type="text/javascript">
		jQuery(document).ready(function(){
			jQuery("div#left_column").remove();
			jQuery("div#right_column").css("float","none");
			jQuery("div#right_column").css("display","block");
			jQuery("div#right_column").css("margin-left","0");
			jQuery("div#right_column").css("width","auto");
			jQuery("input#company_name").focus();
			
		<% if company.errors.any? && !company.errors[:divisions].blank? %>
			divisions_errors();
		<% end %>
		});
		
		function divisions_errors(){
			var division_names = new Array();
			var division_name_fields = jQuery("input[id^=company_divisions_attributes]:text");
			division_name_fields.each( function(){
				var division_name = jQuery(this).val().toUpperCase();
				var last_index_of = division_names.indexOf( division_name );
				if( last_index_of > -1 ){
					jQuery(division_name_fields[last_index_of]).removeClass("error_field").addClass("error_field");
					jQuery(this).addClass("error_field");
				}
				else
					division_names.push(division_name.toUpperCase());
			});
		}
	</script>
	<style type="text/css" media="screen">
		table#division_listing thead tr th:first-child{ width: 10%;}
		table#division_listing thead tr th:first-child + th {text-align:left;width:50%;}
		table#division_listing thead tr th:last-child {text-align:center;}
		div#right_column > h2,table#division_listing caption {font-family:'Nobile',Sans-serif;font-size:14pt;font-weight:bold;margin-top:1.5em;}
	</style>
<% end %>

<%= form_for company, :url => company_path(company) do |f| %>
	<% if company.errors.any? %>
	<div class="form_errors">
		<h2>Please review some of the entries</h2>
		<ul>
		<% company.errors.each do |attr_name, message|%>
			<% if !attr_name.to_s.starts_with?("division") %>
			<li><%= message %></li>
			<% end %>
		<% end %>
		</ul>
	</div>
	<% end %>
	<div class="toolbar">
		<%= f.submit "Save Changes", :class=> "icon_buttons"%>
		<input type="button" onclick="window.location='<%=company_path%>'" value="Cancel" class="icon_buttons"/>
		<% if !company[:updated_at].blank? %>
		<span style="color:#000;float:right;line-height:2">
			Last updated on: <%= company[:updated_at].strftime("%b %d, %Y") %>
		</span>	
		<% end %>	
	</div>
	<h2>Basic Company Information</h2>
	<div class="entry_row">
		<div class="entry_label"><%= f.label :name %></div>
		<div class="entry_value">
			<%= f.text_field :name, :class => (company.errors.any? && !company.errors[:name].blank? ? "error_field": "") %>
		</div>
	</div>
	<table width="100%" class="listing" id="division_listing">
		<caption>Manage Divisions</caption>
		<thead>
			<tr>
				<th>Delete</th>
				<th>Division</th>
				<th>Assign to Company</th>
			</tr>
		</thead>
		<tbody>
		<% company.divisions.each do |d|%>
			<tr>
				<td>
					<%= f.fields_for :divisions,d do |df| %>
					<%= df.check_box :_destroy, :disabled => d.new_record? %>				
				</td>			
				<td>			
					<%= df.text_field :name, :placeholder => (d.new_record? ? "Division":"") %>	
				</td>
				<td>	
					<% if d.new_record? %>
						<%= df.hidden_field :company_id, :value => company[:id]%>
						New division for <%= company[:name]%>
					<% else %>						
						<%= df.collection_select(:company_id, Company.all, :id,:name )%>				
					<% end %>
					<% end %>
				</td>			
			</tr>
		<% end %>
		</tbody>
	</table>
	<div class="toolbar">
		<%= f.submit "Save Changes", :class=> "icon_buttons"%>
		<input type="button" onclick="window.location='<%=company_path%>'" value="Cancel" class="icon_buttons"/>
	</div>			
<% end %>